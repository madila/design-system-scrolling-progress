{"version":3,"names":["_preact","require","_hooks","_store","context","createContext","immutableMap","WeakMap","immutableError","Error","immutableHandlers","get","target","key","receiver","value","Reflect","deepImmutable","set","deleteProperty","has","Proxy","scopeStack","namespaceStack","getContext","namespace","getScope","getNamespace","exports","getElement","ref","attributes","Object","freeze","current","slice","setScope","scope","push","resetScope","pop","setNamespace","resetNamespace","directiveCallbacks","directivePriorities","directive","name","callback","priority","resolve","path","resolvedStore","stores","store","undefined","lock","universalUnlock","split","forEach","p","getEvaluate","entry","args","hasNegationOperator","result","getPriorityLevels","directives","byPriority","keys","reduce","obj","entries","sort","p1","p2","parseInt","map","arr","Directives","priorityLevels","currentPriorityLevel","nextPriorityLevels","element","originalProps","previousScope","useRef","evaluate","useCallback","useContext","cloneElement","props","children","length","h","directiveArgs","directiveName","wrapper","old","options","vnode","__directives","find","suffix","type","createElement","top"],"sources":["@wordpress/interactivity/src/hooks.tsx"],"sourcesContent":["/* @jsx createElement */\n\n/**\n * External dependencies\n */\nimport {\n\th as createElement,\n\toptions,\n\tcreateContext,\n\tcloneElement,\n} from 'preact';\nimport { useRef, useCallback, useContext } from 'preact/hooks';\nimport type { VNode, Context, RefObject } from 'preact';\n\n/**\n * Internal dependencies\n */\nimport { store, stores, universalUnlock } from './store';\ninterface DirectiveEntry {\n\tvalue: string | Object;\n\tnamespace: string;\n\tsuffix: string;\n}\n\ntype DirectiveEntries = Record< string, DirectiveEntry[] >;\n\ninterface DirectiveArgs {\n\t/**\n\t * Object map with the defined directives of the element being evaluated.\n\t */\n\tdirectives: DirectiveEntries;\n\t/**\n\t * Props present in the current element.\n\t */\n\tprops: Object;\n\t/**\n\t * Virtual node representing the element.\n\t */\n\telement: VNode;\n\t/**\n\t * The inherited context.\n\t */\n\tcontext: Context< any >;\n\t/**\n\t * Function that resolves a given path to a value either in the store or the\n\t * context.\n\t */\n\tevaluate: Evaluate;\n}\n\ninterface DirectiveCallback {\n\t( args: DirectiveArgs ): VNode | void;\n}\n\ninterface DirectiveOptions {\n\t/**\n\t * Value that specifies the priority to evaluate directives of this type.\n\t * Lower numbers correspond with earlier execution.\n\t *\n\t * @default 10\n\t */\n\tpriority?: number;\n}\n\ninterface Scope {\n\tevaluate: Evaluate;\n\tcontext: Context< any >;\n\tref: RefObject< HTMLElement >;\n\tattributes: createElement.JSX.HTMLAttributes;\n}\n\ninterface Evaluate {\n\t( entry: DirectiveEntry, ...args: any[] ): any;\n}\n\ninterface GetEvaluate {\n\t( args: { scope: Scope } ): Evaluate;\n}\n\ntype PriorityLevel = string[];\n\ninterface GetPriorityLevels {\n\t( directives: DirectiveEntries ): PriorityLevel[];\n}\n\ninterface DirectivesProps {\n\tdirectives: DirectiveEntries;\n\tpriorityLevels: PriorityLevel[];\n\telement: VNode;\n\toriginalProps: any;\n\tpreviousScope?: Scope;\n}\n\n// Main context.\nconst context = createContext< any >( {} );\n\n// Wrap the element props to prevent modifications.\nconst immutableMap = new WeakMap();\nconst immutableError = () => {\n\tthrow new Error(\n\t\t'Please use `data-wp-bind` to modify the attributes of an element.'\n\t);\n};\nconst immutableHandlers = {\n\tget( target, key, receiver ) {\n\t\tconst value = Reflect.get( target, key, receiver );\n\t\treturn !! value && typeof value === 'object'\n\t\t\t? deepImmutable( value )\n\t\t\t: value;\n\t},\n\tset: immutableError,\n\tdeleteProperty: immutableError,\n};\nconst deepImmutable = < T extends Object = {} >( target: T ): T => {\n\tif ( ! immutableMap.has( target ) )\n\t\timmutableMap.set( target, new Proxy( target, immutableHandlers ) );\n\treturn immutableMap.get( target );\n};\n\n// Store stacks for the current scope and the default namespaces and export APIs\n// to interact with them.\nconst scopeStack: Scope[] = [];\nconst namespaceStack: string[] = [];\n\n/**\n * Retrieves the context inherited by the element evaluating a function from the\n * store. The returned value depends on the element and the namespace where the\n * function calling `getContext()` exists.\n *\n * @param namespace Store namespace. By default, the namespace where the calling\n *                  function exists is used.\n * @return The context content.\n */\nexport const getContext = < T extends object >( namespace?: string ): T =>\n\tgetScope()?.context[ namespace || getNamespace() ];\n\n/**\n * Retrieves a representation of the element where a function from the store\n * is being evalutated. Such representation is read-only, and contains a\n * reference to the DOM element, its props and a local reactive state.\n *\n * @return Element representation.\n */\nexport const getElement = () => {\n\tif ( ! getScope() ) {\n\t\tthrow Error(\n\t\t\t'Cannot call `getElement()` outside getters and actions used by directives.'\n\t\t);\n\t}\n\tconst { ref, attributes } = getScope();\n\treturn Object.freeze( {\n\t\tref: ref.current,\n\t\tattributes: deepImmutable( attributes ),\n\t} );\n};\n\nexport const getScope = () => scopeStack.slice( -1 )[ 0 ];\n\nexport const setScope = ( scope: Scope ) => {\n\tscopeStack.push( scope );\n};\nexport const resetScope = () => {\n\tscopeStack.pop();\n};\n\nexport const getNamespace = () => namespaceStack.slice( -1 )[ 0 ];\n\nexport const setNamespace = ( namespace: string ) => {\n\tnamespaceStack.push( namespace );\n};\nexport const resetNamespace = () => {\n\tnamespaceStack.pop();\n};\n\n// WordPress Directives.\nconst directiveCallbacks: Record< string, DirectiveCallback > = {};\nconst directivePriorities: Record< string, number > = {};\n\n/**\n * Register a new directive type in the Interactivity API runtime.\n *\n * @example\n * ```js\n * directive(\n *   'alert', // Name without the `data-wp-` prefix.\n *   ( { directives: { alert }, element, evaluate } ) => {\n *     const defaultEntry = alert.find( entry => entry.suffix === 'default' );\n *     element.props.onclick = () => { alert( evaluate( defaultEntry ) ); }\n *   }\n * )\n * ```\n *\n * The previous code registers a custom directive type for displaying an alert\n * message whenever an element using it is clicked. The message text is obtained\n * from the store under the inherited namespace, using `evaluate`.\n *\n * When the HTML is processed by the Interactivity API, any element containing\n * the `data-wp-alert` directive will have the `onclick` event handler, e.g.,\n *\n * ```html\n * <div data-wp-interactive=\"messages\">\n *   <button data-wp-alert=\"state.alert\">Click me!</button>\n * </div>\n * ```\n * Note that, in the previous example, the directive callback gets the path\n * value (`state.alert`) from the directive entry with suffix `default`. A\n * custom suffix can also be specified by appending `--` to the directive\n * attribute, followed by the suffix, like in the following HTML snippet:\n *\n * ```html\n * <div data-wp-interactive=\"myblock\">\n *   <button\n *     data-wp-color--text=\"state.text\"\n *     data-wp-color--background=\"state.background\"\n *   >Click me!</button>\n * </div>\n * ```\n *\n * This could be an hypothetical implementation of the custom directive used in\n * the snippet above.\n *\n * @example\n * ```js\n * directive(\n *   'color', // Name without prefix and suffix.\n *   ( { directives: { color }, ref, evaluate } ) =>\n *     colors.forEach( ( color ) => {\n *       if ( color.suffix = 'text' ) {\n *         ref.style.setProperty(\n *           'color',\n *           evaluate( color.text )\n *         );\n *       }\n *       if ( color.suffix = 'background' ) {\n *         ref.style.setProperty(\n *           'background-color',\n *           evaluate( color.background )\n *         );\n *       }\n *     } );\n *   }\n * )\n * ```\n *\n * @param name             Directive name, without the `data-wp-` prefix.\n * @param callback         Function that runs the directive logic.\n * @param options          Options object.\n * @param options.priority Option to control the directive execution order. The\n *                         lesser, the highest priority. Default is `10`.\n */\nexport const directive = (\n\tname: string,\n\tcallback: DirectiveCallback,\n\t{ priority = 10 }: DirectiveOptions = {}\n) => {\n\tdirectiveCallbacks[ name ] = callback;\n\tdirectivePriorities[ name ] = priority;\n};\n\n// Resolve the path to some property of the store object.\nconst resolve = ( path, namespace ) => {\n\tlet resolvedStore = stores.get( namespace );\n\tif ( typeof resolvedStore === 'undefined' ) {\n\t\tresolvedStore = store( namespace, undefined, {\n\t\t\tlock: universalUnlock,\n\t\t} );\n\t}\n\tlet current = {\n\t\t...resolvedStore,\n\t\tcontext: getScope().context[ namespace ],\n\t};\n\tpath.split( '.' ).forEach( ( p ) => ( current = current[ p ] ) );\n\treturn current;\n};\n\n// Generate the evaluate function.\nexport const getEvaluate: GetEvaluate =\n\t( { scope } ) =>\n\t( entry, ...args ) => {\n\t\tlet { value: path, namespace } = entry;\n\t\tif ( typeof path !== 'string' ) {\n\t\t\tthrow new Error( 'The `value` prop should be a string path' );\n\t\t}\n\t\t// If path starts with !, remove it and save a flag.\n\t\tconst hasNegationOperator =\n\t\t\tpath[ 0 ] === '!' && !! ( path = path.slice( 1 ) );\n\t\tsetScope( scope );\n\t\tconst value = resolve( path, namespace );\n\t\tconst result = typeof value === 'function' ? value( ...args ) : value;\n\t\tresetScope();\n\t\treturn hasNegationOperator ? ! result : result;\n\t};\n\n// Separate directives by priority. The resulting array contains objects\n// of directives grouped by same priority, and sorted in ascending order.\nconst getPriorityLevels: GetPriorityLevels = ( directives ) => {\n\tconst byPriority = Object.keys( directives ).reduce<\n\t\tRecord< number, string[] >\n\t>( ( obj, name ) => {\n\t\tif ( directiveCallbacks[ name ] ) {\n\t\t\tconst priority = directivePriorities[ name ];\n\t\t\t( obj[ priority ] = obj[ priority ] || [] ).push( name );\n\t\t}\n\t\treturn obj;\n\t}, {} );\n\n\treturn Object.entries( byPriority )\n\t\t.sort( ( [ p1 ], [ p2 ] ) => parseInt( p1 ) - parseInt( p2 ) )\n\t\t.map( ( [ , arr ] ) => arr );\n};\n\n// Component that wraps each priority level of directives of an element.\nconst Directives = ( {\n\tdirectives,\n\tpriorityLevels: [ currentPriorityLevel, ...nextPriorityLevels ],\n\telement,\n\toriginalProps,\n\tpreviousScope,\n}: DirectivesProps ) => {\n\t// Initialize the scope of this element. These scopes are different per each\n\t// level because each level has a different context, but they share the same\n\t// element ref, state and props.\n\tconst scope = useRef< Scope >( {} as Scope ).current;\n\tscope.evaluate = useCallback( getEvaluate( { scope } ), [] );\n\tscope.context = useContext( context );\n\t/* eslint-disable react-hooks/rules-of-hooks */\n\tscope.ref = previousScope?.ref || useRef( null );\n\t/* eslint-enable react-hooks/rules-of-hooks */\n\n\t// Create a fresh copy of the vnode element and add the props to the scope,\n\t// named as attributes (HTML Attributes).\n\telement = cloneElement( element, { ref: scope.ref } );\n\tscope.attributes = element.props;\n\n\t// Recursively render the wrapper for the next priority level.\n\tconst children =\n\t\tnextPriorityLevels.length > 0 ? (\n\t\t\t<Directives\n\t\t\t\tdirectives={ directives }\n\t\t\t\tpriorityLevels={ nextPriorityLevels }\n\t\t\t\telement={ element }\n\t\t\t\toriginalProps={ originalProps }\n\t\t\t\tpreviousScope={ scope }\n\t\t\t/>\n\t\t) : (\n\t\t\telement\n\t\t);\n\n\tconst props = { ...originalProps, children };\n\tconst directiveArgs = {\n\t\tdirectives,\n\t\tprops,\n\t\telement,\n\t\tcontext,\n\t\tevaluate: scope.evaluate,\n\t};\n\n\tsetScope( scope );\n\n\tfor ( const directiveName of currentPriorityLevel ) {\n\t\tconst wrapper = directiveCallbacks[ directiveName ]?.( directiveArgs );\n\t\tif ( wrapper !== undefined ) props.children = wrapper;\n\t}\n\n\tresetScope();\n\n\treturn props.children;\n};\n\n// Preact Options Hook called each time a vnode is created.\nconst old = options.vnode;\noptions.vnode = ( vnode: VNode< any > ) => {\n\tif ( vnode.props.__directives ) {\n\t\tconst props = vnode.props;\n\t\tconst directives = props.__directives;\n\t\tif ( directives.key )\n\t\t\tvnode.key = directives.key.find(\n\t\t\t\t( { suffix } ) => suffix === 'default'\n\t\t\t).value;\n\t\tdelete props.__directives;\n\t\tconst priorityLevels = getPriorityLevels( directives );\n\t\tif ( priorityLevels.length > 0 ) {\n\t\t\tvnode.props = {\n\t\t\t\tdirectives,\n\t\t\t\tpriorityLevels,\n\t\t\t\toriginalProps: props,\n\t\t\t\ttype: vnode.type,\n\t\t\t\telement: createElement( vnode.type as any, props ),\n\t\t\t\ttop: true,\n\t\t\t};\n\t\t\tvnode.type = Directives;\n\t\t}\n\t}\n\n\tif ( old ) old( vnode );\n};\n"],"mappings":"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"}