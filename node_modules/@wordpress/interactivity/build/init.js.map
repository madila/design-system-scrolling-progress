{"version":3,"names":["_preact","require","_vdom","_utils","_constants","regionRootFragments","WeakMap","getRegionRootFragment","region","has","set","createRootFragment","parentElement","get","exports","yieldToMain","Promise","resolve","setTimeout","initialVdom","init","nodes","document","querySelectorAll","directivePrefix","node","hydratedIslands","fragment","vdom","toVdom","hydrate"],"sources":["@wordpress/interactivity/src/init.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport { hydrate } from 'preact';\n/**\n * Internal dependencies\n */\nimport { toVdom, hydratedIslands } from './vdom';\nimport { createRootFragment } from './utils';\nimport { directivePrefix } from './constants';\n\n// Keep the same root fragment for each interactive region node.\nconst regionRootFragments = new WeakMap();\nexport const getRegionRootFragment = ( region ) => {\n\tif ( ! regionRootFragments.has( region ) ) {\n\t\tregionRootFragments.set(\n\t\t\tregion,\n\t\t\tcreateRootFragment( region.parentElement, region )\n\t\t);\n\t}\n\treturn regionRootFragments.get( region );\n};\n\nfunction yieldToMain() {\n\treturn new Promise( ( resolve ) => {\n\t\t// TODO: Use scheduler.yield() when available.\n\t\tsetTimeout( resolve, 0 );\n\t} );\n}\n\n// Initial vDOM regions associated with its DOM element.\nexport const initialVdom = new WeakMap();\n\n// Initialize the router with the initial DOM.\nexport const init = async () => {\n\tconst nodes = document.querySelectorAll(\n\t\t`[data-${ directivePrefix }-interactive]`\n\t);\n\n\tfor ( const node of nodes ) {\n\t\tif ( ! hydratedIslands.has( node ) ) {\n\t\t\tawait yieldToMain();\n\t\t\tconst fragment = getRegionRootFragment( node );\n\t\t\tconst vdom = toVdom( node );\n\t\t\tinitialVdom.set( node, vdom );\n\t\t\tawait yieldToMain();\n\t\t\thydrate( vdom, fragment );\n\t\t}\n\t}\n};\n"],"mappings":";;;;;;AAGA,IAAAA,OAAA,GAAAC,OAAA;AAIA,IAAAC,KAAA,GAAAD,OAAA;AACA,IAAAE,MAAA,GAAAF,OAAA;AACA,IAAAG,UAAA,GAAAH,OAAA;AATA;AACA;AACA;;AAEA;AACA;AACA;;AAKA;AACA,MAAMI,mBAAmB,GAAG,IAAIC,OAAO,CAAC,CAAC;AAClC,MAAMC,qBAAqB,GAAKC,MAAM,IAAM;EAClD,IAAK,CAAEH,mBAAmB,CAACI,GAAG,CAAED,MAAO,CAAC,EAAG;IAC1CH,mBAAmB,CAACK,GAAG,CACtBF,MAAM,EACN,IAAAG,yBAAkB,EAAEH,MAAM,CAACI,aAAa,EAAEJ,MAAO,CAClD,CAAC;EACF;EACA,OAAOH,mBAAmB,CAACQ,GAAG,CAAEL,MAAO,CAAC;AACzC,CAAC;AAACM,OAAA,CAAAP,qBAAA,GAAAA,qBAAA;AAEF,SAASQ,WAAWA,CAAA,EAAG;EACtB,OAAO,IAAIC,OAAO,CAAIC,OAAO,IAAM;IAClC;IACAC,UAAU,CAAED,OAAO,EAAE,CAAE,CAAC;EACzB,CAAE,CAAC;AACJ;;AAEA;AACO,MAAME,WAAW,GAAAL,OAAA,CAAAK,WAAA,GAAG,IAAIb,OAAO,CAAC,CAAC;;AAExC;AACO,MAAMc,IAAI,GAAG,MAAAA,CAAA,KAAY;EAC/B,MAAMC,KAAK,GAAGC,QAAQ,CAACC,gBAAgB,CACrC,SAASC,0BAAiB,eAC5B,CAAC;EAED,KAAM,MAAMC,IAAI,IAAIJ,KAAK,EAAG;IAC3B,IAAK,CAAEK,qBAAe,CAACjB,GAAG,CAAEgB,IAAK,CAAC,EAAG;MACpC,MAAMV,WAAW,CAAC,CAAC;MACnB,MAAMY,QAAQ,GAAGpB,qBAAqB,CAAEkB,IAAK,CAAC;MAC9C,MAAMG,IAAI,GAAG,IAAAC,YAAM,EAAEJ,IAAK,CAAC;MAC3BN,WAAW,CAACT,GAAG,CAAEe,IAAI,EAAEG,IAAK,CAAC;MAC7B,MAAMb,WAAW,CAAC,CAAC;MACnB,IAAAe,eAAO,EAAEF,IAAI,EAAED,QAAS,CAAC;IAC1B;EACD;AACD,CAAC;AAACb,OAAA,CAAAM,IAAA,GAAAA,IAAA"}