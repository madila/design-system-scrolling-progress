{"version":3,"names":["hydrate","toVdom","hydratedIslands","createRootFragment","directivePrefix","regionRootFragments","WeakMap","getRegionRootFragment","region","has","set","parentElement","get","yieldToMain","Promise","resolve","setTimeout","initialVdom","init","nodes","document","querySelectorAll","node","fragment","vdom"],"sources":["@wordpress/interactivity/src/init.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport { hydrate } from 'preact';\n/**\n * Internal dependencies\n */\nimport { toVdom, hydratedIslands } from './vdom';\nimport { createRootFragment } from './utils';\nimport { directivePrefix } from './constants';\n\n// Keep the same root fragment for each interactive region node.\nconst regionRootFragments = new WeakMap();\nexport const getRegionRootFragment = ( region ) => {\n\tif ( ! regionRootFragments.has( region ) ) {\n\t\tregionRootFragments.set(\n\t\t\tregion,\n\t\t\tcreateRootFragment( region.parentElement, region )\n\t\t);\n\t}\n\treturn regionRootFragments.get( region );\n};\n\nfunction yieldToMain() {\n\treturn new Promise( ( resolve ) => {\n\t\t// TODO: Use scheduler.yield() when available.\n\t\tsetTimeout( resolve, 0 );\n\t} );\n}\n\n// Initial vDOM regions associated with its DOM element.\nexport const initialVdom = new WeakMap();\n\n// Initialize the router with the initial DOM.\nexport const init = async () => {\n\tconst nodes = document.querySelectorAll(\n\t\t`[data-${ directivePrefix }-interactive]`\n\t);\n\n\tfor ( const node of nodes ) {\n\t\tif ( ! hydratedIslands.has( node ) ) {\n\t\t\tawait yieldToMain();\n\t\t\tconst fragment = getRegionRootFragment( node );\n\t\t\tconst vdom = toVdom( node );\n\t\t\tinitialVdom.set( node, vdom );\n\t\t\tawait yieldToMain();\n\t\t\thydrate( vdom, fragment );\n\t\t}\n\t}\n};\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,OAAO,QAAQ,QAAQ;AAChC;AACA;AACA;AACA,SAASC,MAAM,EAAEC,eAAe,QAAQ,QAAQ;AAChD,SAASC,kBAAkB,QAAQ,SAAS;AAC5C,SAASC,eAAe,QAAQ,aAAa;;AAE7C;AACA,MAAMC,mBAAmB,GAAG,IAAIC,OAAO,CAAC,CAAC;AACzC,OAAO,MAAMC,qBAAqB,GAAKC,MAAM,IAAM;EAClD,IAAK,CAAEH,mBAAmB,CAACI,GAAG,CAAED,MAAO,CAAC,EAAG;IAC1CH,mBAAmB,CAACK,GAAG,CACtBF,MAAM,EACNL,kBAAkB,CAAEK,MAAM,CAACG,aAAa,EAAEH,MAAO,CAClD,CAAC;EACF;EACA,OAAOH,mBAAmB,CAACO,GAAG,CAAEJ,MAAO,CAAC;AACzC,CAAC;AAED,SAASK,WAAWA,CAAA,EAAG;EACtB,OAAO,IAAIC,OAAO,CAAIC,OAAO,IAAM;IAClC;IACAC,UAAU,CAAED,OAAO,EAAE,CAAE,CAAC;EACzB,CAAE,CAAC;AACJ;;AAEA;AACA,OAAO,MAAME,WAAW,GAAG,IAAIX,OAAO,CAAC,CAAC;;AAExC;AACA,OAAO,MAAMY,IAAI,GAAG,MAAAA,CAAA,KAAY;EAC/B,MAAMC,KAAK,GAAGC,QAAQ,CAACC,gBAAgB,CACrC,SAASjB,eAAiB,eAC5B,CAAC;EAED,KAAM,MAAMkB,IAAI,IAAIH,KAAK,EAAG;IAC3B,IAAK,CAAEjB,eAAe,CAACO,GAAG,CAAEa,IAAK,CAAC,EAAG;MACpC,MAAMT,WAAW,CAAC,CAAC;MACnB,MAAMU,QAAQ,GAAGhB,qBAAqB,CAAEe,IAAK,CAAC;MAC9C,MAAME,IAAI,GAAGvB,MAAM,CAAEqB,IAAK,CAAC;MAC3BL,WAAW,CAACP,GAAG,CAAEY,IAAI,EAAEE,IAAK,CAAC;MAC7B,MAAMX,WAAW,CAAC,CAAC;MACnBb,OAAO,CAAEwB,IAAI,EAAED,QAAS,CAAC;IAC1B;EACD;AACD,CAAC"}